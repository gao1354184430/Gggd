#start
#魔戒负载均衡dynamic_resolve fallback=stale fail_timeout=60s; 
#azure承载节点-直接查找替换：
#azhk3-f4s   20.187.118.101 
#azhk4-f4s   20.239.173.237 
#azhk5-f4s   20.194.163.242  
#azjp6-f4s   20.239.59.14
#azjp7-f4s   20.48.108.33
#azhk8-f2s   20.239.129.78
#azjp10-f4s  20.89.106.58
#azhk-backup 153.122.102.51 gmo日本1
#azhk-backup 153.122.173.25 gmo日本2
#azbackup 日本NTT 164.70.90.243   香港103.166.247.35
upstream jp{
        #ip_hash;  #MJ-JP AZ承载  微调后由azjp3.4.5.6联入，其他备份
        server 20.187.118.101:16617;
        server 20.239.173.237:16617;
        server 20.194.163.242:16617;
        server 20.239.59.14:16617;
        server 20.48.108.33:16617 backup;
        server 20.239.129.78:16617 backup; #azhk9临时
        server 20.89.106.58:16617 backup; 
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp; #健康检测
}
upstream cvjp{
        #ip_hash;
        server 20.187.118.101:26601;
        server 20.239.173.237:26601;
        server 20.194.163.242:26601;
        server 20.239.59.14:26601;
        server 20.48.108.33:26601 backup;
        server 20.239.129.78:26601 backup;
        server 20.89.106.58:26601 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp; #健康检测
}
upstream sg{  
        #ip_hash;  #BGP承载，AZ备用
        server 20.239.59.14:16618;
        server 20.187.118.101:16618;
        server 20.239.173.237:16618;
        server 20.194.163.242:16618;
        server 20.48.108.33:16618;
        server 20.239.129.78:16618; #azhk9
        server 20.89.106.58:16618; #azjp10
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp; #健康检测
}
upstream cvsg{
        #ip_hash;  #BGP承载，AZ备用
        server 20.239.59.14:26603;
        server 20.48.108.33:26603;
        server 20.187.118.101:26603;
        server 20.239.173.237:26603;
        server 20.194.163.242:26603;
        server 20.239.129.78:26603;
        server 20.89.106.58:26603;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp; #健康检测
}
upstream cvhk{
        #ip_hash;  #BGP承载，AZ备用
        server 20.239.59.14:26607;
        server 20.48.108.33:26607;
        server 20.187.118.101:26607;
        server 20.239.173.237:26607;
        server 20.194.163.242:26607;
        server 20.239.129.78:26607; #azhk9
        server 20.89.106.58:26607; #azjp10
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp; #健康检测
}
upstream kr{
        ip_hash;	#vu负载
        server 20.200.210.162:6616;    #kr2
        server 20.214.184.79:6616;    #kr3
        server 158.247.230.29:6616;     #kr4
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream cvkr{
        ip_hash;	#vu+aws负载
        server 20.200.210.162:8818;    #kr2
        server 20.214.184.79:8818;    #kr3
        #server 158.247.230.29:8818;     #kr4
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream tw_n{
        server 20.187.118.101:16616;
        server 20.239.173.237:16616;
        server 20.194.163.242:16616;
        server 20.239.59.14:16616;
        server 20.48.108.33:16616;
        server 20.239.129.78:16616; #azhk9
        server 20.89.106.58:16616; #azjp10
        server 153.122.102.51:16616 backup;
        server 153.122.173.25:16616 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream cvtw{
        server 20.239.59.14:26604;
        server 20.48.108.33:26604;
        server 20.187.118.101:26604;  #二次反代-包含BGP
        server 20.239.173.237:26604;
        server 20.194.163.242:26604;
        server 20.239.129.78:26604; #azhk9
        server 20.89.106.58:26604; #azjp10
        server 153.122.102.51:26604 backup;
        server 153.122.173.25:26604 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream fqtw{
        server 20.187.118.101:23330;  #二次反代
        server 20.239.173.237:23330;
        server 20.194.163.242:23330;
        server 20.239.59.14:23330;
        server 20.48.108.33:23330;
        server 20.239.129.78:23330; #azhk9
        server 20.89.106.58:23330; #azjp10
        server 153.122.102.51:23330 backup;
        server 153.122.173.25:23330 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream mjhk{
        server 20.239.59.14:16620;   #HKT
        server 20.48.108.33:16620;
        server 20.187.118.101:16620;
        server 20.239.173.237:16620;
        server 20.194.163.242:16620;
        server 20.239.129.78:16620; #azhk9
        server 20.89.106.58:16620; #azjp10
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream hkt2{
        server 20.239.59.14:16631;
        server 20.48.108.33:16631;
        server 20.187.118.101:16631;
        server 20.239.173.237:16631;
        server 20.194.163.242:16631;
        server 20.239.129.78:16631; #azhk9
        server 20.89.106.58:16631; #azjp10
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream mjazhk{  #MJ-az-默认直接azhk4落地，故障转移az承载-FDC落地
        server 20.24.89.172:6620 weight=5;     #AZHK9F8s 
		server 104.208.102.141:6622 ;  #AZHK10 
        server 20.239.59.14:16620 backup;
        server 20.48.108.33:16620 backup;
        server 20.187.118.101:16620 backup;
        server 20.239.173.237:16620 backup;
        server 20.194.163.242:16620 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream mjazusd{
        #ip_hash;
        server 20.187.118.101:16650;
        server 20.239.173.237:16650;
        server 20.194.163.242:16650;
        server 20.239.59.14:16650;
        server 20.48.108.33:16650;
        server 20.239.129.78:16650;
        server 20.89.106.58:16650;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp; #健康检测
}
upstream mjtr{
        server 20.239.59.14:16630;
        server 20.48.108.33:16630;
        server 20.187.118.101:16630;
        server 20.239.173.237:16630;
        server 20.194.163.242:16630;
        server 20.239.129.78:16630; #azhk9
        server 20.89.106.58:16630; #azjp10
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream mjeufi{  #欧洲承载（DE）目的地芬兰
        server 89.163.224.151:16643;  #直连IP 37.157.255.188
        server 54.38.220.90:16643;  #直连 54.37.203.19
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream de{
        ip_hash;	#de德国
        server 89.163.224.151:6616;  #直连IP 37.157.255.188
        server 54.38.220.90:6616; #直连 54.37.203.19
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream uk{
        #ip_hash;	#vu英国负载
        server 198.244.241.217:6616;
        #server 78.141.247.250:6616 weight=6;
		#check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream fr{
        #ip_hash;	#vu法国负载
        server 212.129.58.216:6616;
        #server 95.179.213.2:6616 weight=6;
		#check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream br{
        ip_hash;	#vu巴西负载
        server 216.238.103.47:6616;
		#check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream mjmx{
        ip_hash;	#vu墨西哥负载
        server 216.238.81.179:6616;	
		#check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream ru{
        server 193.38.50.175:6616;  #魔戒俄罗斯
		#check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream in{
        server 172.105.42.158:16626;
		#check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream mjkh{
        #ip_hash;    #魔戒柬埔寨
        server 220.158.232.156:6616;
        #server 220.158.232.157:6616;
		#check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream hkntt{	
        server 20.187.118.101:16621;
        server 20.239.173.237:16621;
        server 20.194.163.242:16621;
        server 20.239.59.14:16621;
        server 20.48.108.33:16621;
		server 210.0.158.101:7777 backup;  #当NTT出现故障转移至HGC
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream hgc{
        server 20.187.118.101:16621;
        server 20.239.173.237:16621;
        server 20.194.163.242:16621;
        server 20.239.59.14:16621;
        server 20.48.108.33:16621;
        #server 210.0.158.101:7777;  #交给隧道处理
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream cvhgc{
        #ip_hash;  # AZ承载
        server 20.187.118.101:26608;
        server 20.239.173.237:26608;
        server 20.194.163.242:26608;
        server 20.239.59.14:26608;
        server 20.48.108.33:26608;
        server 20.239.129.78:26608; 
        server 20.89.106.58:26608; 
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp; #健康检测
}
upstream fqhgc{
        server 210.0.158.101:7711;
		#check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
#此处开始为AZ中转，三机器负载，换IP可进行查找替换
upstream hk_az{   #交给隧道处理-az-fdc
        server 20.187.118.101:26633;
        server 20.239.173.237:26633;
        server 20.194.163.242:26633;
        server 20.239.59.14:26633;
        server 20.48.108.33:26633;
        server 20.239.129.78:26633; #azhk9
        server 20.89.106.58:26633; #azjp10
        server 153.122.102.51:26633 backup;
        server 153.122.173.25:26633 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream hk_hgc_n_az{   #交给隧道处理-az-fdc
        server 20.187.118.101:26622;
        server 20.239.173.237:26622;
        server 20.194.163.242:26622;
        server 20.239.59.14:26622;
        server 20.48.108.33:26622;
        server 20.239.129.78:26622; #azhk9
        server 20.89.106.58:26622; #azjp10
        server 153.122.102.51:26622 backup;
        server 153.122.173.25:26622 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream malai_vnet{ 
		server 20.187.118.101:26623;#交给隧道处理
        server 20.239.173.237:26623;
        server 20.194.163.242:26623;
        server 20.239.59.14:26623;
        server 20.48.108.33:26623;
        server 20.239.129.78:26623; #azhk9
        server 20.89.106.58:26623; #azjp10
        server 153.122.102.51:26623 backup;
        server 153.122.173.25:26623 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream cvmalai_vnet{
		server 20.187.118.101:26610;  #交给隧道处理
        server 20.239.173.237:26610;
        server 20.194.163.242:26610;
        server 20.239.59.14:26610;
        server 20.48.108.33:26610;
        server 153.122.102.51:26610 backup;
		server 153.122.173.25:26610 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream fqmalai_vnet{
		server 20.187.118.101:10044;  #交给隧道处理
        server 20.239.173.237:10044;
        server 20.194.163.242:10044;
        server 20.239.59.14:10044;
        server 20.48.108.33:10044;
        server 153.122.102.51:10044 backup;
        server 153.122.173.25:10044 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
#结束
upstream mjar{
        server 20.187.118.101:16628;
        server 20.239.173.237:16628;
        server 20.194.163.242:16628;
        server 20.239.59.14:16628;
        server 20.48.108.33:16628;
        server 20.239.129.78:16628; #azhk9
        server 20.89.106.58:16628; #azjp10
        server 153.122.102.51:16628 backup;
        server 153.122.173.25:16628 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
#狗子的
upstream xy_hgc_vnet{
		server 20.187.118.101:22383;  #交给隧道处理-xinyun_vnet负载
        server 20.239.173.237:22383;
        server 104.208.89.249:22383;
        server 20.239.59.14:22383;
        server 20.48.108.33:22383;
        server 153.122.102.51:22383 backup;
        server 153.122.173.25:22383 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream dog_sg_vnet{
		server 20.187.118.101:10650;  #交给隧道处理
        server 20.239.173.237:10650;
        server 104.208.89.249:10650;
        server 20.239.59.14:10650;
        server 20.48.108.33:10650;
        server 153.122.102.51:10650 backup;
        server 153.122.173.25:10650 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
upstream dog_tw_vnet{
		server 20.187.118.101:10651;  #交给隧道处理
        server 20.239.173.237:10651;
        server 104.208.89.249:10651;
        server 20.239.59.14:10651;
        server 20.48.108.33:10651;
        server 153.122.102.51:10651 backup;
        server 153.122.173.25:10651 backup;
		check interval=5000 rise=2 fall=2 timeout=3000 type=tcp;
}
#魔戒端口监听
server {
    listen 16616;
    location / {
		proxy_pass http://tw_n;   #台湾采用nginx二次反代
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16617;
    location / {
		proxy_pass http://jp;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16618;
    location / {
		proxy_pass http://sg;
		include /usr/local/nginx/ws; 
        }
	location /status { #监控页面
        check_status;
        access_log   off;
    }
}
server {
    listen 16619;
    location / {
		proxy_pass http://kr;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16620;
    location / {
		proxy_pass http://mjhk;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16621;
    location / {
		proxy_pass http://hgc;
		include /usr/local/nginx/ws; 
        }
}  #16622是hkbn
server {
    listen 16622;   #缺失16623分配亚洲
    location / {
		proxy_pass http://210.0.159.89:6616; #新HGC
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16624;
    location / {
		proxy_pass http://hkntt;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16625;
    location / {
		proxy_pass http://ru;  #魔戒俄罗斯
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16626;
    location / {
		proxy_pass http://in;  #魔戒印度
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16627;
    location / {
		proxy_pass http://mjazhk;  #魔戒AZHK落地
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16628;
    location / {
		proxy_pass http://mjar;  #魔戒阿根廷
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16629;
    location / {
		proxy_pass http://77.91.74.10:6616;  #魔戒以色列
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16630;
    location / {
		proxy_pass http://mjtr;  #魔戒土耳其
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16631;
    location / {
		proxy_pass http://hkt2;  #HKT2
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16632;
    location / {
		proxy_pass http://45.35.105.2:6616;  #US
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16633;
    location / {
		proxy_pass http://50.7.17.56:6616;  #FDC-HK
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16634;
    location / {
		proxy_pass http://mjkh;  #柬埔寨
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16635;
    location / {
		proxy_pass http://br;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16636;
    location / {
		proxy_pass http://mjmx;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16637;   #乌克兰-基辅
    location / {
		proxy_pass http://45.87.155.63:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16638;   #澳洲-悉尼
    location / {
		proxy_pass http://170.187.240.57:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16639;   #非洲-尼日利亚-拉各斯
    location / {
		proxy_pass http://156.238.26.202:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16640;   #非洲-南非
    location / {
		proxy_pass http://156.38.157.165:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16641;   #加拿大东海岸
    location / {
		proxy_pass http://192.99.193.179:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16642;   #荷兰
    location / {
		proxy_pass http://62.4.14.33:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16643;   #芬兰-经德国中转
    location / {
		proxy_pass http://mjeufi;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16644;
    location / {
		proxy_pass http://uk;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16645;
    location / {
		proxy_pass http://fr;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16646;
    location / {
		proxy_pass http://77.91.102.96:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16647;  #RU2
    location / {
		proxy_pass http://194.147.85.61:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16648;
    location / {
		proxy_pass http://45.82.251.79:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16649;
    location / {
		proxy_pass http://45.144.3.172:6616;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16650;
    location / {
		proxy_pass http://mjazusd;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 16651;
    location / {
		proxy_pass http://185.203.6.195:6616;
		include /usr/local/nginx/ws; 
        }
}
#MJ嵌套区域-az-266弃用，魔戒仅用166端口
server {
    listen 26622;
    location / {
		proxy_pass http://hk_hgc_n_az;  #az到hgc_n
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26633;
    location / {
		proxy_pass http://hk_az;  #az到FDC
		include /usr/local/nginx/ws; 
        }
}
#cv和fq-CV2节点
server {
    listen 26601;
    location / {
		proxy_pass http://cvjp;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26602;
    location / {
		proxy_pass http://cvkr;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26603;
    location / {
		proxy_pass http://cvsg;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26604;
    location / {
		proxy_pass http://cvtw; #二次反代
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26605;
    location / {
		proxy_pass http://220.246.250.224:8818; #CV2 HKT
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26606;
    location / {
		proxy_pass http://45.82.251.79:8818; #美国圣何塞
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26607;
    location / {
		proxy_pass http://cvhk;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26608;
    location / {
		proxy_pass http://cvhgc;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26609; #香港 HKBN
    location / {
		proxy_pass http://46.20.99.186:8818;   
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26610;
    location / {
		proxy_pass http://cvmalai_vnet; 
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26612; #香港
    location / {
		proxy_pass http://203.218.244.202:8879;   
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26616; #香港 HGC
    location / {
		proxy_pass http://223.18.59.110:8819;   
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26617; #俄罗斯
    location / {
		proxy_pass http://193.38.50.175:8818;   
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26618; #德国
    location / {
		proxy_pass http://89.163.224.151:8818;   
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 26623;
    location / {
		proxy_pass http://malai_vnet; 
		include /usr/local/nginx/ws; 
        }
}
#266**结束
server {
    listen 23308; #美国
    location / {
		proxy_pass http://66.94.125.131:1666;   
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 23321;
    location / {
		proxy_pass http://fqhgc;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 23309;
    location / {
		proxy_pass http://de;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 23330;
    location / {
		proxy_pass http://fqtw;    #二次反代
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 10044;
    location / {
		proxy_pass http://fqmalai_vnet; 
		include /usr/local/nginx/ws; 
        }
}
#狗子负载均衡（177xx段）
#xinyun_vnet负载
server {
    listen 22383;
    location / {
		proxy_pass http://xy_hgc_vnet;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 10650;
    location / {
		proxy_pass http://dog_sg_vnet;
		include /usr/local/nginx/ws; 
        }
}
server {
    listen 10651;
    location / {
		proxy_pass http://dog_tw_vnet;
		include /usr/local/nginx/ws; 
        }
}
#end